{
  lib,
  pkgs,
  bifrost,
  isServer,
  ...
}: let
  inherit (lib.modules) mkIf;

  cfg = bifrost.programs.pentest;
in {
  config = mkIf (!isServer && cfg.enable && cfg.full) {
    environment.systemPackages = with pkgs; [
      wireshark
    ];

    security = {
      wrappers.dumpcap = {
        source = "${pkgs.wireshark}/bin/dumpcap";
        capabilities = "cap_net_raw,cap_net_admin+ep";
        owner = "root";
        group = "wireshark";
      };
    };
  };
}
